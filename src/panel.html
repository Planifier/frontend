<!DOCTYPE html>
<html
	lang="en"
	data-theme="corporate"
>
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0"
		/>
		<title>My projects</title>
		<link
			href="./output.css"
			rel="stylesheet"
		/>
	</head>
	<body>
		<div class="navbar bg-base-200 px-12 py-3 pb-0 sm:pb-3">
			<div class="navbar-start">
				<h2 class="text-xl font-medium">My projects</h2>
			</div>
			<div class="navbar-end gap-4">
				<a
					href
					data-toggle-theme="business,corporate"
					data-act-class="ACTIVECLASS"
				>
					<!-- prettier-ignore -->
					<svg
						class="opacity-75"
						version="1.0"
						id="Layer_1"
						xmlns="http://www.w3.org/2000/svg"
						xmlns:xlink="http://www.w3.org/1999/xlink"
						width="20px"
						height="20px"
						viewBox="0 0 64 64"
						enable-background="new 0 0 64 64"
						xml:space="preserve"
					>
						<g>
							<path
								class="fill-base-content"
								d="M32,0C18.745,0,8,10.746,8,24c0,9.843,5.928,18.297,14.406,22h19.188C50.072,42.297,56,33.843,56,24
					   C56,10.746,45.255,0,32,0z M41,26c-0.553,0-1-0.447-1-1c0-1.104-0.896-2-2-2s-2,0.896-2,2v19h-2V25c0-1.104-0.896-2-2-2
					   s-2,0.896-2,2v19h-2V25c0-1.104-0.896-2-2-2s-2,0.896-2,2c0,0.553-0.447,1-1,1s-1-0.447-1-1c0-2.209,1.791-4,4-4
					   c1.201,0,2.267,0.541,3,1.38c0.733-0.839,1.799-1.38,3-1.38s2.267,0.541,3,1.38c0.733-0.839,1.799-1.38,3-1.38c2.209,0,4,1.791,4,4
					   C42,25.553,41.553,26,41,26z M45,13c-0.742,0.742-1.687-0.313-1.687-0.313C40.418,9.791,36.418,8,32,8c-0.553,0-1-0.447-1-1
					   s0.447-1,1-1c4.971,0,9.471,2.015,12.729,5.271C44.729,11.271,45.742,12.258,45,13z"
							/>
							<path
								class="fill-base-content"
								d="M26,64h12c2.211,0,4-1.789,4-4H22C22,62.211,23.789,64,26,64z"
							/>
							<polygon
								class="fill-base-content"
								points="22,48.004 22,52 42,52 42,48.004 42,48 22,48 	"
							/>
							<rect
								x="22"
								y="54"
								class="fill-base-content"
								width="20"
								height="4"
							/>
						</g></svg>
				</a>
				<button
					id="logout_btn"
					class="btn btn-error btn-sm"
				>
					log out
					<!-- prettier-ignore -->
					<svg
						width="20px"
						height="20px"
						viewBox="0 0 24 24"
						fill="none"
						xmlns="http://www.w3.org/2000/svg"
						class="opacity-75 stroke-base-content"
					>
						<g id="Interface / Log_Out">
							<path
								id="Vector"
								d="M12 15L15 12M15 12L12 9M15 12H4M9 7.24859V7.2002C9 6.08009 9 5.51962 9.21799 5.0918C9.40973 4.71547 9.71547 4.40973 10.0918 4.21799C10.5196 4 11.0801 4 12.2002 4H16.8002C17.9203 4 18.4796 4 18.9074 4.21799C19.2837 4.40973 19.5905 4.71547 19.7822 5.0918C20 5.5192 20 6.07899 20 7.19691V16.8036C20 17.9215 20 18.4805 19.7822 18.9079C19.5905 19.2842 19.2837 19.5905 18.9074 19.7822C18.48 20 17.921 20 16.8031 20H12.1969C11.079 20 10.5192 20 10.0918 19.7822C9.71547 19.5905 9.40973 19.2839 9.21799 18.9076C9 18.4798 9 17.9201 9 16.8V16.75"
								stroke-width="2"
								stroke-linecap="round"
								stroke-linejoin="round"
							/>
						</g>
					</svg>
				</button>
			</div>
		</div>
		<div class="join w-full">
			<div class="drawer drawer-open h-dvh overflow-hidden">
				<input
					id="my-drawer-2"
					type="checkbox"
					class="drawer-toggle"
				/>
				<div
					class="drawer-content flex flex-col items-center justify-center"
				></div>
				<div class="drawer-side">
					<label
						for="my-drawer-2"
						aria-label="close sidebar"
						class="drawer-overlay"
					></label>
					<ul
						id="projects_list"
						class="menu p-4 w-dvw sm:w-80 min-h-full bg-base-200 text-base-content"
					>
						<li>
							<button
								class="btn btn-primary btn-sm m-4 text-white"
								onclick="project_name_prompt.showModal()"
							>
								<img
									width="20"
									src="add-project.svg"
									class="invert"
								/>
								create new project
							</button>
						</li>
					</ul>
				</div>
			</div>
			<p class="opacity-75 w-0 hidden sm:block sm:w-full self-center">
				No project selected...
			</p>
		</div>

		<dialog
			id="project_name_prompt"
			class="modal"
		>
			<div class="modal-box">
				<form method="dialog">
					<button
						id="close_dial"
						class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2"
					>
						âœ•
					</button>
				</form>
				<h3
					id="proj_indic"
					class="font-bold text-lg mb-5"
				>
					Project name
				</h3>
				<div class="w-full join justify-around items-end">
					<input
						id="make-a-sandwich"
						type="text"
						placeholder="Make a sandwich..."
						class="input input-bordered w-full max-w-xs"
					/>
					<button
						class="btn btn-outline btn-success"
						onclick="save_proj()"
					>
						Create
					</button>
				</div>
			</div>
		</dialog>
	</body>
	<script src="https://cdn.jsdelivr.net/npm/theme-change@2.0.2/index.js"></script>
	<script src="bridge/bridge.js"></script>
	<script>
		loginAccount('ema', 'aze');

		const projectsList = document.getElementById('projects_list');
		const createdProjEl = function (name, id) {
			return '<li id="' + id + '" ><a>' + name + '</a></li>';
		};
		const sharedProjEl = function (name, id) {
			return (
				'<li id="' +
				id +
				'" ><a class="join justify-between">' +
				name +
				'<svg width="15px" height="15px" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" class="opacity-75 fill-base-content"><path d="M23.313 26.102l-6.296-3.488c2.34-1.841 2.976-5.459 2.976-7.488v-4.223c0-2.796-3.715-5.91-7.447-5.91-3.73 0-7.544 3.114-7.544 5.91v4.223c0 1.845 0.78 5.576 3.144 7.472l-6.458 3.503s-1.688 0.752-1.688 1.689v2.534c0 0.933 0.757 1.689 1.688 1.689h21.625c0.931 0 1.688-0.757 1.688-1.689v-2.534c0-0.994-1.689-1.689-1.689-1.689zM23.001 30.015h-21.001v-1.788c0.143-0.105 0.344-0.226 0.502-0.298 0.047-0.021 0.094-0.044 0.139-0.070l6.459-3.503c0.589-0.32 0.979-0.912 1.039-1.579s-0.219-1.32-0.741-1.739c-1.677-1.345-2.396-4.322-2.396-5.911v-4.223c0-1.437 2.708-3.91 5.544-3.91 2.889 0 5.447 2.44 5.447 3.91v4.223c0 1.566-0.486 4.557-2.212 5.915-0.528 0.416-0.813 1.070-0.757 1.739s0.446 1.267 1.035 1.589l6.296 3.488c0.055 0.030 0.126 0.063 0.184 0.089 0.148 0.063 0.329 0.167 0.462 0.259v1.809zM30.312 21.123l-6.39-3.488c2.34-1.841 3.070-5.459 3.070-7.488v-4.223c0-2.796-3.808-5.941-7.54-5.941-2.425 0-4.904 1.319-6.347 3.007 0.823 0.051 1.73 0.052 2.514 0.302 1.054-0.821 2.386-1.308 3.833-1.308 2.889 0 5.54 2.47 5.54 3.941v4.223c0 1.566-0.58 4.557-2.305 5.915-0.529 0.416-0.813 1.070-0.757 1.739 0.056 0.67 0.445 1.267 1.035 1.589l6.39 3.488c0.055 0.030 0.126 0.063 0.184 0.089 0.148 0.063 0.329 0.167 0.462 0.259v1.779h-4.037c0.61 0.46 0.794 1.118 1.031 2h3.319c0.931 0 1.688-0.757 1.688-1.689v-2.503c-0.001-0.995-1.689-1.691-1.689-1.691z"></path></svg></a></li>'
			);
		};

		function showProj(projectId, isCreator) {
			getProject(projectId).then((projSearchResult) => {
				let projName = JSON.parse(projSearchResult)['name'];
				projectsList.innerHTML += isCreator
					? createdProjEl(projName, projectId)
					: sharedProjEl(projName, projectId);

				setTimeout(() => {
					let element = document.getElementById(projectId);
					element.onclick = function () {
						updateCurrentlySelectedProject(projectId);
						// TELEPORT TO PAGE PANEL
					};
				}, 100);
			});
		}

		function showProjects() {
			projectsOf(currentUserId).then((retrievedList) => {
				let projects = JSON.parse(retrievedList);
				for (const projectId in projects) {
					let isCreator = projects[projectId] == 'Creator';
					showProj(projectId, isCreator);
				}
			});
		}

		document.addEventListener('userinitialized', (e) => showProjects());
	</script>
	<script>
		function listenForHold(delay) {
			var mouseIsDown = false;
			var idTimeout;

			let onContact = function () {
				mouseIsDown = true;
				idTimeout = setTimeout(function () {
					if (mouseIsDown) {
						const selectedEls = document.querySelectorAll(':hover').values();
						let selectedEl = selectedEls.next();
						while (!selectedEl.done) {
							let projectElement = selectedEl.value;
							if (
								!projectElement.hasAttribute('id') ||
								projectElement.id.match(/^[a-f\d]{24}$/i) === null
							) {
								selectedEl = selectedEls.next();
								continue;
							}

							let delResult = deleteProject(projectElement.id);
							delResult.then((response) => {
								if (response != 404) {
									projectElement.remove();
									return;
								}
							});

							selectedEl = selectedEls.next();
						}
					}
				}, delay);
			};
			let onNoContact = function () {
				clearTimeout(idTimeout);
				mouseIsDown = false;
			};

			document.addEventListener('mousedown', onContact);
			document.addEventListener('mouseup', onNoContact);
			document.addEventListener('mouseleave', onNoContact);

			document.addEventListener('touchstart', onContact, { passive: true });
			document.addEventListener('touchend', onNoContact, { passive: true });
			document.addEventListener('touchmove', onNoContact, { passive: true });
		}

		listenForHold(1500);
	</script>
	<script>
		const modalInputEl = document.getElementById('make-a-sandwich');
		const closeDialBtn = document.getElementById('close_dial');

		function save_proj() {
			let proj_name = modalInputEl.value;
			if (proj_name.length >= 16 || proj_name.trim().length === 0) {
				modalInputEl.classList.add('input-error');
				setTimeout(() => {
					modalInputEl.classList.remove('input-error');
				}, 1000);
				return;
			}

			createProject(currentUserId, proj_name).then((projObj) => {
				showProj(JSON.parse(projObj)['id'], true);
			});

			closeDialBtn.click();
		}
	</script>
</html>
